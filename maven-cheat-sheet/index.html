<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PQ63V8S');</script>
<!-- End Google Tag Manager -->

    


    <title>Maven 使用手册 – Algony Tony – etvdyn</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="" />
    <meta property="og:description" content="" />
    
    <meta name="author" content="Algony Tony" />

    
    <meta property="og:title" content="Maven 使用手册" />
    <meta property="twitter:title" content="Maven 使用手册" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <link rel="alternate" type="application/rss+xml" title="Algony Tony - etvdyn" href="/feed.xml" />

    

    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3291441471504209"
     crossorigin="anonymous"></script>


    <link type="application/atom+xml" rel="alternate" href="https://algony-tony.github.io/feed.xml" title="Algony Tony" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Maven 使用手册 | Algony Tony</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Maven 使用手册" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="etvdyn" />
<meta property="og:description" content="etvdyn" />
<link rel="canonical" href="https://algony-tony.github.io/maven-cheat-sheet/" />
<meta property="og:url" content="https://algony-tony.github.io/maven-cheat-sheet/" />
<meta property="og:site_name" content="Algony Tony" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-10-13T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Maven 使用手册" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-10-13T00:00:00+08:00","datePublished":"2022-10-13T00:00:00+08:00","description":"etvdyn","headline":"Maven 使用手册","mainEntityOfPage":{"@type":"WebPage","@id":"https://algony-tony.github.io/maven-cheat-sheet/"},"url":"https://algony-tony.github.io/maven-cheat-sheet/"}</script>
<!-- End Jekyll SEO tag -->


  </head>

  <body>

    
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PQ63V8S"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


    <header class="site-header">

    <div class="wrapper-header">
      <div class="header-left">
        <!-- <a href="/" class="site-avatar"><img src="/assets/img/sys/jekyll-logo.png" alt="avatar" /></a> -->

        <a class="site-info" href="/">
          <span class="site-name">Algony Tony</span>
          <span class="site-description">etvdyn</span>
        </a>

      </div>

      <nav class="header-right">
        
        <a href="/"  class="page-link"  >
          首页
        </a>
        
        <a href="/WebMap/"  class="page-link"  >
          导航
        </a>
        
        <a href="/tools/"  class="page-link"  >
          工具
        </a>
        
        <a href="/collections/"  class="page-link"  >
          归档
        </a>
        
      </nav>
    </div>

</header>


    <main class="default-content" aria-label="内容区">
  <div class="wrapper-content">

    <article class="post">
      <div class="left">
        <h1>Maven 使用手册</h1>
        <div class="label">

          <div class="label-date">
            2022-10-13
          </div>

          <div class="label-category">
            <span >类别:</span>

<a class="category-link" href="https://algony-tony.github.io/category/#软件技术" title="Category: 软件技术">
  软件技术
</a>


          </div>

          <div class="label-tag">
            <span >标签:</span>

<a class="tag-link" href="https://algony-tony.github.io/tag/#Maven" title="Tag: Maven">
  Maven
</a>

          </div>

        </div>

        <div class="entry">
          <ul id="markdown-toc">
  <li><a href="#安装配置" id="markdown-toc-安装配置">安装配置</a>    <ul>
      <li><a href="#maven-配置" id="markdown-toc-maven-配置">Maven 配置</a></li>
    </ul>
  </li>
  <li><a href="#pom" id="markdown-toc-pom">POM</a>    <ul>
      <li><a href="#pom-结构" id="markdown-toc-pom-结构">POM 结构</a></li>
      <li><a href="#super-pom" id="markdown-toc-super-pom">Super POM</a></li>
      <li><a href="#依赖管理" id="markdown-toc-依赖管理">依赖管理</a></li>
    </ul>
  </li>
  <li><a href="#插件" id="markdown-toc-插件">插件</a>    <ul>
      <li><a href="#插件目标" id="markdown-toc-插件目标">插件目标</a></li>
      <li><a href="#maven-生命周期" id="markdown-toc-maven-生命周期">Maven 生命周期</a></li>
    </ul>
  </li>
  <li><a href="#参考链接" id="markdown-toc-参考链接">参考链接</a></li>
</ul>

<p>如 Maven 官网介绍，Maven 是一个管理和理解软件项目的工具。Maven 是一个强大的工具，有着陡峭的学习曲线，它的创始人 J​​ason van Zyl 在 2002 年开始创建 Maven，后面开了个公司 Sonatype。
Maven 通常被理解为一个 “build tool”。</p>

<ul>
  <li>入门文档 <a href="https://books.sonatype.com/mvnex-book/reference/index.html">Maven by Example</a> <a href="/assets/file/mvnref-pdf.pdf">(PDF, 2.7 MB)</a></li>
  <li>参考手册 <a href="https://books.sonatype.com/mvnref-book/reference/index.html">Maven: The Complete Reference</a> <a href="/assets/file/mvnref-pdf.pdf">(PDF, 1.3 MB)</a>。</li>
</ul>

<p>Maven 采用<strong>约定大于配置（Convention Over Configuration）</strong>的原则，Maven 默认假设源代码都在 <code class="language-plaintext highlighter-rouge">${basedir}/src/main/java</code>，resources 都在 <code class="language-plaintext highlighter-rouge">${basedir}/src/main/resources</code>，测试在 <code class="language-plaintext highlighter-rouge">${basedir}/src/test</code>，项目默认构建 jar 文件，编译后的 bytecode 在 <code class="language-plaintext highlighter-rouge">${basedir}/target/classes</code>，创建的 jar 放在 <code class="language-plaintext highlighter-rouge">${basedir}/target</code>。不仅是文件目录，Maven 的核心插件也共享约定来编译打包构建分发等流程。</p>

<h2 id="安装配置">安装配置</h2>

<p>Maven 安装后的目录很简洁，主要如下几个文件夹以及 LICENSE，NOTICE，README.txt 文件</p>

<ul>
  <li>bin：包含 Linux 和 Windows 下的 <code class="language-plaintext highlighter-rouge">mvn</code> 命令以及它的 debug 模式命令 <code class="language-plaintext highlighter-rouge">mvnDebug</code>，<code class="language-plaintext highlighter-rouge">mvn</code> 脚本主要用来配置 Java 命令，准备 classpath 和相关的配置，最后执行 Java 命令；</li>
  <li>boot：只有 plexus-classworlds-<version>.jar 以及它的 license 文件，plexus-classworlds 是一个类加载器，相对于默认的 Java 类加载器，它提供更丰富的语法以方便配置，Maven 使用该框架加载自己的类库，[Plexus ClassWorlds](http://codehaus-plexus.github.io/plexus-classworlds/)；</version></li>
  <li>conf：配置文件目录，主要就是最重要的 settings.xml 文件，这个后面单独详细介绍；</li>
  <li>lib：包含 Maven 运行时需要的 Java 类库，包含 Maven 的各模块类库以及 Maven 依赖的三方类库；</li>
</ul>

<p>Maven 默认把配置和代码仓库放在 ~/.m2 文件夹下，包含个人的 settings.xml 配置文件和 repository 文件夹。</p>

<p>Maven 的环境变量 <code class="language-plaintext highlighter-rouge">M2_HOME</code> 指向 Maven 的安装路径。<code class="language-plaintext highlighter-rouge">MAVEN_OPTS</code> 配置的参数传递给 <code class="language-plaintext highlighter-rouge">mvn</code> 脚本里的 Java 命令，比如配置内存大小 <code class="language-plaintext highlighter-rouge">-Xmx1024m -XX:MaxPermSize=512m</code>。</p>

<h3 id="maven-配置">Maven 配置</h3>

<p><a href="https://maven.apache.org/configure.html">配置 Maven</a></p>

<h2 id="pom">POM</h2>

<p>Maven 项目的核心是 pom.xml 文件，POM（Project Object Model） 是项目对象模型，最简单的一个 pom.xml 文件如下，前面都是固定内容，指定 xml 文档的内容，以及使用的 POM 模型的版本 4.0.0，最重要的是 groupId，artifactId，version，这三个元素构成了项目的唯一标识符，在 Maven 的世界里，任何的 jar，pom，war 都是基于这三个元素的坐标来定位的，还有 package 和 classifier 两个坐标属性，一般写作 groupId:artifactId:packaging:version。</p>

<ul>
  <li>groupId: 定义了项目属于某个组，一般以组织机构的网站反序，如 com.google.foobar；</li>
  <li>artifactId: 给出了当前组下的唯一 ID；</li>
  <li>version: 版本号，1.0-SNAPSHOT 中 SNAPSHOT 是快照的意思，指的当前版本还在开发中，是不稳定版本；</li>
  <li>package: 定义了打包方式；</li>
  <li>classifier: 第五个坐标，很少被使用，</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>org.example<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>MyProject<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;</span>
    <span class="nt">&lt;name&gt;</span>My Project<span class="nt">&lt;/name&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<h3 id="pom-结构">POM 结构</h3>

<p><img src="/assets/img/post/maven-pom.png" alt="The Project Object Model" title="The Project Object Model" /></p>

<p>POM 主要由四个部分组成：</p>
<ul>
  <li>一般项目信息（General project information）：包含项目名称，URL，赞助机构，开发和贡献者清单和项目许可证；</li>
  <li>构建设置（Build settings）：在这一部分可以定制化默认 Maven 构建的行为。可以改变 source 和 tests 的路径，增加新的插件，把插件目标加入生命周期，也可以定制化网站生成参数；</li>
  <li>构建环境（Build environment）：此部分由对应不同环境的 profiles 组成。比如，在开发阶段需要把代码发布到开发服务器上，而在生产环境则需要发布到生产服务器上；</li>
  <li>POM 关系（POM relationships）：此部分包含依赖其他项目的关系，从父项目继承 POM 设置，定义它自己的坐标，包含的子模块等。</li>
</ul>

<h3 id="super-pom">Super POM</h3>

<p>Maven 中有一个 Super POM 的概念，它是所有 Maven 项目 POM 文件的父级 POM，类似于 <code class="language-plaintext highlighter-rouge">java.lang.Object</code> 是所有 Java 类的父类一样。Super POM 可以在<a href="https://maven.apache.org/ref/3.6.3/maven-model-builder/super-pom.html">官网</a>找到，也可以在本地安装包中 lib 下的 maven-x.y.z-uber.jar 或 maven-model-builder-x.y.z.jar 中找到，在 <code class="language-plaintext highlighter-rouge">org.apache.maven.model</code> 包下找到 pom-4.0.0.xml 文件。</p>

<p>Super POM 定义了被所有项目继承的一些标准配置变量。它定义了命名为 central 的远程 Maven 仓库，同样地命名为 central 的插件仓库，在 build 元素下定义了 Maven 项目的标准目录结构。</p>

<p>下面 help 插件的 effective-pom 目标会打印出由 Super POM 和当前 pom 合并后的有效配置项。</p>

<pre><code class="language-base">mvn help:effective-pom
</code></pre>

<h3 id="依赖管理">依赖管理</h3>

<p>Maven 中的一个最佳实践就是在多模块项目中使用父项目 pom.xml 中的 <strong>dependencyManagement</strong> 来避免子项目中重复的依赖信息。不这么做，每个子项目都要重复定义需要依赖的 version,scope,exclusions 等，子项目没有覆盖的配置项都会使用父项目 pom.xml 中的。比如在父 pom.xml 中定义依赖如下</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencyManagement&gt;</span>
  <span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>4.8.1<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>hibernate-commons-annotations<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.3.0.ga<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>hibernate<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>3.2.5.ga<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;exclusions&gt;</span>
        <span class="nt">&lt;exclusion&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>javax.transaction<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>jta<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/exclusion&gt;</span>
      <span class="nt">&lt;/exclusions&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
  <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div>

<p>子项目 pom.xml 也需要申明依赖项但是可以省去其他，如下。</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>hibernate-annotations<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>hibernate<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<p>还有就是把重复共用的版本号配置到 properties 中，还可以使用内置的属性值来引用其他子项目 <code class="language-plaintext highlighter-rouge">${project.groupId}</code>, <code class="language-plaintext highlighter-rouge">${project.version}</code>。</p>

<p>另一条最佳实践是把用到的库依赖都显式地写出来，因为有依赖传递，有一些底层库虽然没有显式地写出项目也不会报错，但是却埋下了隐患，后续直接依赖的库如果移除了依赖会导致本项目的报错。
可以用下面命令来分析项目依赖关系，找出依赖的底层库显式地写到依赖里。</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><div class="line-1"><span class="c"># 分析依赖关系，找出被用到的库却没显式地申明和申明了却没在使用的库，但是有误报的可能，具体还是需要自己判断。</span>
</div><div class="line-2">mvn dependency:analyze
</div></code></pre></figure>

<h2 id="插件">插件</h2>

<p>Maven 是使用基于插件的架构构建的，它的大部分功能都在插件中。<a href="https://maven.apache.org/plugins/">插件地址</a>。同样的，在多模块的项目中，插件也可以在父 pom.xml 文件中通过 <strong>pluginManagement</strong> 来统一管理。</p>

<h3 id="插件目标">插件目标</h3>

<p>执行插件目标的命令 <code class="language-plaintext highlighter-rouge">mvn archetype:generate</code>，其中 archetype 是插件的标识符，generate 是目标的标识符。Maven 插件就是由一个或多个目标组成的集合，
目标是一项特殊的任务，可以独立执行，也可以和其他目标一起构成一个大型构建（build）。在 Maven 中，目标是工作的一个基本单元，目标通过配置属性进行配置，这些属性可以定制化行为。</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><div class="line-1"><span class="c"># 显示插件 exec 的所有目标，以及所有有效参数</span>
</div><div class="line-2">mvn <span class="nb">help</span>:describe <span class="nt">-Dplugin</span><span class="o">=</span><span class="nb">exec</span> <span class="nt">-Dfull</span>
</div><div class="line-3">
</div><div class="line-4"><span class="c"># 解析项目依赖关系</span>
</div><div class="line-5">mvn dependency:resolve
</div><div class="line-6">
</div><div class="line-7"><span class="c"># 解析项目依赖树</span>
</div><div class="line-8">mvn dependency:tree
</div></code></pre></figure>

<h3 id="maven-生命周期">Maven 生命周期</h3>

<p><a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html">Maven 生命周期（Lifecycle）</a>由阶段（phase）组成，生命周期由一个验证项目基本的完整性的阶段开始，由部署项目到生产环境的阶段结束。目前内置的有三个生命周期 default，site，clean。生命周期的阶段概念是有意模糊的，包含验证，测试和部署等，它们在不同的项目中可以指代不一样的事情，比如在一个 Java 包项目里 package 阶段生成一个 JAR 包，而一个 web 应用的项目在 package 阶段生成一个 WAR 包。</p>

<p>插件目标可以附加到生命周期中的某个阶段。Maven 顺着阶段移动，它会执行阶段中附加的插件目标，每个阶段都有零个到多个目标，</p>

<p><img src="/assets/img/post/maven-lifecycle.png" alt="Maven Lifecycle" /></p>

<h2 id="参考链接">参考链接</h2>

<p><a href="https://maven.apache.org/">Apache Maven</a></p>

<p><a href="http://www.kyleblaney.com/maven-best-practices">Maven Best Practices</a></p>


        </div>

        
<div class="comments" id="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'https-algony-tony-github-io';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


      </div>

      
      <div class="right">
    <div class="side-wrap">
        <!-- Content -->
        <nav class="side-content">
            <ul id="content-side" class="content-ul">
                <li><a href="#comments">评论区</a></li>
            </ul>
        </nav>
    </div>
</div>

<script src="/assets/js/postContent.js" charset="utf-8"></script>
      

      

    </article>

  </div>
</main>

    
      <footer class="site-footer">

  <div class="wrapper-footer">
    <div class="social-wrapper">
      







<a href="/feed.xml"><i class="svg-icon rss"></i></a>




    </div>

    <div>
      <p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
    </div>

    <div>Site powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://pages.github.com/">Github Pages</a>.</div>
  </div>

</footer>

    

  </body>
</html>

